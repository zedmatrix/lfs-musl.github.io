<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="../ymusl-lfs.css" />
    <title>Musl Enter Chroot Script - 2025</title>
  </head>
  <body class="ylfs" id="lfs-r1.0-1-musl-sysv-mdev">
<div class="header">
  <div class="section">
    <h2>Linux From Scratch - musl</h2>
        <h3>Version r1.0-1-sysv-mdev</h3>
    <h3>Musl Enter Chroot Script - 2025</h3>
    <p class="info">Script to Enter the chroot environment.</p>
  </div>
</div>

<div class="section">
  <div class="padbox">
    <h4>Sources:</h4><p>
Download URL: <a href="../sources/Zlfs-chroot.sh">sources/Zlfs-chroot.sh</a><br>
SHA256 Sum: <code>f4fe7ba5848bf0b620f6f6627c2c7a2eb2adb3ba056558007bb59691c2e2c850</code><br>
    <h4>Enter The Chroot</h4><p>This Script handles the pre and post mounting of the virtual kernel filesystems.<br>
    </p>
  </div>
</div>

<div class="section"><pre class="bash">cat &gt; Zlfs-chroot.sh &lt;&lt; "EOF"
#!/bin/bash
zprint() { echo -e "\033[1;32m *** $1 *** \033[0m"; }
stars() { printf '%.0s*' {1..100}; printf '\n'; }
LFS=/mnt/ylfs

chroot_pre() {
    stars
    zprint " === Mounting Virtual Kernel Filesystems === "
    mkdir -pv $LFS/{dev,proc,sys,run}
    mount --types proc /proc $LFS/proc
    mount --rbind /sys $LFS/sys
    mount --make-rslave $LFS/sys
    mount --rbind /dev $LFS/dev
    mount --make-rslave $LFS/dev
    mount --rbind /run $LFS/run
    mount --make-slave $LFS/run

    if [ -h $LFS/dev/shm ]; then
        install -v -d -m 1777 $LFS$(realpath /dev/shm)
    else
        mount -vt tmpfs -o nosuid,nodev tmpfs $LFS/dev/shm
    fi
    if [ ! -f $LFS/etc/resolv.conf ]; then
        printf "nameserver 1.1.1.1\nnameserver 8.8.8.8\n" > $LFS/etc/resolv.conf
    fi
    stars
}

chroot_exec() {
    stars
    zprint " === Entering Chroot $LFS === "
    /usr/sbin/chroot "$LFS" \
    /usr/bin/env -i HOME=/root TERM="$TERM" \
    PS1="\[\$?\](lfs chroot) \u:\w\$ " \
    PATH=/usr/bin:/usr/sbin \
    MAKEFLAGS="-j$(nproc)" \
    TESTSUITEFLAGS="-j$(nproc)" \
    /bin/bash --login
    zprint " === Welcome Back === "
    stars
}
check_unmount() { mountpoint -q "$1" &amp;&amp; umount -v -l "$1"; }

chroot_post() {
    stars
    zprint " === Un-Mounting Virtual Kernel Filesystems === "
    check_unmount $LFS/sys/firmware/efi/efivars
    check_unmount $LFS/dev
    check_unmount $LFS/run
    check_unmount $LFS/proc
    check_unmount $LFS/sys
    stars
}
stars
# checks if directory exists
[ ! -d $LFS ] &amp;&amp; { zprint "Error $LFS is not a mountpoint"; exit 1; }

# mounts virtual kernel filesystems
chroot_pre

# enters the new root environment
chroot_exec

# cleans up the virtual kernel filesystems
chroot_post

stars
EOF</pre></div>

<div class="section">
  <div class="padbox">
  <p>Just prepare the script and <span class="command"><strong>chmod -v +x Zlfs-chroot.sh</strong></span> and execute it so you automate the enter and exit of the chroot environment.<br>
  I have added a helpful error code to the prompt.
  </p>
  </div>
</div>


</body></html>
