package:
    name: p11-kit
    version: 0.25.5
    rel: 1
    archive: false
    delete: true

sources:
    - url: https://github.com/p11-glue/p11-kit/releases/download/0.25.5/p11-kit-0.25.5.tar.xz
      md5: e9c5675508fcd8be54aa4c8cb8e794fc
      sha256: 04d0a86450cdb1be018f26af6699857171a188ac6d5b8c90786a60854e1198e5

patches:
    - url: /ybuild/sources/trust-extract-compat.patch
      md5: 5afe88fbc7951ac3f13619147479711d

prepare: |
    meson setup Ybuild --prefix=/usr --buildtype=release -D trust_paths=/etc/pki/anchors

build: |
    ninja -C Ybuild

check: |
    LC_ALL=C ninja test -C Ybuild

install: |
    ninja -C Ybuild install &&
    ln -sfv /usr/libexec/p11-kit/trust-extract-compat /usr/bin/update-ca-certificates;
    ln -sfv ./pkcs11/p11-kit-trust.so /usr/lib/libnssckbi.so

required:
    - libtasn1

optional:
    - gtk-doc
    - libxslt
    - nss
