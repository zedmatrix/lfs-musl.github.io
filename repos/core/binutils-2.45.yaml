package:
    name: binutils
    version: 2.45
    rel: 1
    archive: false
    delete: true

sources:
    - url: https://sourceware.org/pub/binutils/releases/binutils-2.45.tar.xz
      md5: dee5b4267e0305a99a3c9d6131f45759
      sha256: c50c0e7f9cb188980e2cc97e4537626b1672441815587f1eab69d2a1bfbef5d2

prepare: |
    mkdir -v ybuild && cd ybuild && ../configure --prefix=/usr --sysconfdir=/etc --enable-ld=default \
    --enable-plugins --enable-shared --disable-werror --enable-64-bit-bfd --enable-new-dtags \
    --with-system-zlib --enable-default-hash-style=gnu

build: |
    cd ybuild && make tooldir=/usr

check: |
    make -k check && grep '^FAIL:' $(find -name '*.log') || true

install: |
    cd ybuild && make tooldir=/usr install &&
    rm -rfv /usr/lib/lib{bfd,ctf,ctf-nobfd,gprofng,opcodes,sframe}.a /usr/share/doc/gprofng/
